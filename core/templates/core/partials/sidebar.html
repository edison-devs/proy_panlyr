{% load groups %}

<nav class="col-md-2 sidebar min-vh-100 overflow-auto">
    <h5 class="text-center py-3">{{ user.username }}</h5>
    <ul class="nav flex-column">
        
        <!-- PRODUCTS -->
        {% if user|has_any_group:"admin,employed,viewer" %}
        <li class="nav-item">
            <a class="nav-link text-white d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#menuProducts" role="button" aria-expanded="false" aria-controls="menuProducts">
            <span><i class="fa-solid fa-box me-2"></i> PRODUCTOS</span>
            <span class="badge bg-secondary">▸</span>
            </a>
            <div class="collapse" id="menuProducts">
                <ul class="nav flex-column ms-3">
                    <li class="nav-item">
                        <a  href="{% url 'product-index' %}" class="nav-link text-white">Ver</a>
                    </li>
                    
                    {% if user|has_any_group:"admin,employed" %}
                    <li class="nav-item">
                        <a class="nav-link text-white" href="{% url 'product-create' %}?action=new">Nuevo</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </li>
        {% endif %}

        <!-- DELIVERY -->
        {% if user|has_any_group:"admin,employed,viewer" %}
        <li class="nav-item">
            <a class="nav-link text-white d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#menuPedidos" role="button" aria-expanded="false" aria-controls="menuPedidos">
                <span><i class="fa-solid fa-truck me-2"></i> PEDIDOS</span><span class="badge bg-secondary">▸</span>
            </a>
            <div class="collapse" id="menuPedidos">
                <ul class="nav flex-column ms-3">
                    <li class="nav-item">
                        <a class="nav-link text-white">Ver</a>
                    </li>
                    
                    {% if user|has_any_group:"admin,employed" %}
                    <li class="nav-item">
                        <a class="nav-link text-white">Nuevo</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </li>
        {% endif %}

       
        <!-- REPORT -->
        {% if user|has_any_group:"admin,employed,viewer" %}
        <li class="nav-item">
            <a class="nav-link text-white d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#menuReportes" role="button" aria-expanded="false" aria-controls="menuReportes">
            <span><i class="fa-solid fa-chart-line"></i> REPORTES</span>
            <span class="badge bg-secondary">▸</span>
            </a>
            <div class="collapse" id="menuReportes">
                {% comment %} <ul class="nav flex-column ms-3">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="{% url 'report' %}">Ver</a>
                    </li>
                    {% if user|has_any_group:"admin,employed" %}
                    <li class="nav-item">
                        <a class="nav-link text-white" href="{% url 'invoices' %}?action=new">Nuevo</a>
                    </li>
                    {% endif %}
                </ul> {% endcomment %}
            </div>
        </li>
        {% endif %}

        <!-- CATEGORIES -->
        {% if user|has_any_group:"admin,employed,viewer" %}
        <li class="nav-item">
            <a class="nav-link text-white d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#menuCategories" role="button" aria-expanded="false" aria-controls="menuCategories">
            <span><i class="fa-solid fa-tags"></i> REPORTES</span>
            <span class="badge bg-secondary">▸</span>
            </a>
            <div class="collapse" id="menuCategories">
                {% comment %} <ul class="nav flex-column ms-3">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="{% url 'category_products-index' %}">Listar</a>
                    </li>
                    {% if user|has_any_group:"admin,employed" %}
                    <li class="nav-item">
                        <a class="nav-link text-white" href="{% url 'category_products-create' %}?action=new">Nuevo</a>
                    </li>
                    {% endif %}
                </ul> {% endcomment %}
            </div>
        </li>
        {% endif %}

        <!-- USERS - Solo para admin -->
        {% if user|has_group:"admin" %}
        <li class="nav-item">
            <a class="nav-link text-white d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#menuUsers" role="button" aria-expanded="false" aria-controls="menuUsers">
                 <span><i class="fa-solid fa-users me-2"></i> USUARIOS</span<span class="badge bg-secondary">▸</span>
            </a>
            <div class="collapse" id="menuUsers">
                {% comment %} <ul class="nav flex-column ms-3">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="{% url 'index' %}">Ver</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="{% url 'index' %}?action=new">Nuevo</a>
                    </li>
                </ul> {% endcomment %}
            </div>
        </li>
        {% endif %}

        <!-- LOGOUT -->
        <li class="nav-item">
            <a class="nav-link text-white" href="{% url 'logout' %}"> <i class="fa-solid fa-door-open me-2"></i> CERRAR SESIÓN</a>
        </li>

        <!-- Debug info (opcional) -->
        {% if debug %}
        <li class="nav-item mt-4">
            <div class="small text-info">
                <strong>Grupos:</strong> {{ user|get_groups|join:", " }}
            </div>
        </li>
        {% endif %}
    </ul>
</nav>






